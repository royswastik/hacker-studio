<html>
  <script type="text/javascript">
  /**
   * This file is used as an invisible BrowserWindow to read from files in a separate process
   * IPC Events are emitted from module fsHelper.js, which is used to read data and connect to this file
   */
    const ipc = require('electron').ipcRenderer;
    const fs= require('fs');
    const path=require('path');
    const glob= require('glob');
    const BrowserWindow = require('electron').remote.BrowserWindow;

    ipc.on('get-categories-fs', function (event, number, fromWindowId) {
      console.log("get-categories-fs");
          const fromWindow = BrowserWindow.fromId(fromWindowId);
          let meta_file=fs.readFileSync('./data/meta.json');
          let result =  meta_file.toString();
          fromWindow.webContents.send('categories-fetched-fs', number, result);
    });
    
    ipc.on('get-problems-by-categoryId-fs', function (event, categoryId, fromWindowId) {
      console.log("get-categories-fs");
          const fromWindow = BrowserWindow.fromId(fromWindowId);
          let meta_file=fs.readFileSync('./data/'+categoryId+'/meta.json');
          let result =  meta_file.toString();
          result = JSON.parse(result);
          fromWindow.webContents.send('problem-list-fetched-fs', categoryId, result);
    });
    
    ipc.on('get-problem-by-id-fs', function (event,problemId, categoryId, fromWindowId) {
          const fromWindow = BrowserWindow.fromId(fromWindowId);
          let meta_file=fs.readFileSync('./data/'+categoryId+'/'+problemId+'/meta.json');
          let result =  meta_file.toString();
          result = JSON.parse(result);
          fromWindow.webContents.send('problem-fetched', categoryId, result);    
    });

    ipc.on('get-solution-by-name-fs', function (event,problemId, categoryId,solutionName, fromWindowId) {
          const fromWindow = BrowserWindow.fromId(fromWindowId);
          let meta_file=fs.readFileSync('./data/'+categoryId+'/'+problemId+'/'+solutionName+'.in');
          let input =  meta_file.toString();
          meta_file=fs.readFileSync('./data/'+categoryId+'/'+problemId+'/'+solutionName+'.out');
          let output =  meta_file.toString();
          let result = {
            "problemId":problemId,
            "categoryId": categoryId,
            "solutionName": solutionName,
            "input": input,
            "output": output
          };
          fromWindow.webContents.send('solution-fetched',result);
          
    });
    
    ipc.on('close-fs-helper', function (event,fromWindowId) {
        console.log("Closing Window");
          const fromWindow = BrowserWindow.fromId(fromWindowId);
          fromWindow.webContents.send('fs-helper-closed', fromWindowId);
          window.close();
    });
    
  </script>
</html>